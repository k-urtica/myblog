---
slug: /nuxt-trailing-slash
title: Nuxt.jsでURL末尾にスラッシュ(trailing slash)を付ける方法
date: 2020-03-19T15:58:36
updatedAt: ""
cover: cover.jpg
coverCaption: ""
summary: Nuxt.jsでURL末尾のスラッシュ（trailing slash）を強制的に付けて、アプリケーションで末尾スラッシュの有無を統一させる方法。
tags: [NuxtJS]
---

## トレイリングスラッシュ（trailing slash）とは？

トレイリングスラッシュについてご存知でしょうか？URL末尾に付く`/` (スラッシュ)のことです。このURL末尾のスラッシュは有っても無くても何の問題もありません。

例えば、`/post`のような末尾スラッシュなしの場合は`postファイル`をリクエストしたものとして扱われるのですが、`postファイル`が存在しない場合（＝実際はサブディレクトリの場合）自動的にスラッシュが付与されたURLへリダイレクトされます。そのためページアクセスの点で言えばスラッシュありなしどちらでも問題はなく、また通常特に気にする必要はないです。

## トレイリングスラッシュの混在はよくない

前述の通り、末尾スラッシュの有無で挙動に問題が発生するわけではないですが、スラッシュの有無が混在したURLがあるのはSEO的によくありません。リダイレクトされる分の時間もかかります（微々たるものですが）

アプリケーションとしてはトレイリングスラッシュ有りか無しどちらにするにしても、どちらかに統一させるべきです。

## Nuxt.jsでトレイリングスラッシュを付与する

Nuxt.jsでトレイリングスラッシュを付与する場合は独自に処理を書いて実現することも可能ですが、Nuxt 2.10.1からトレイリングスラッシュを強制的に付けることができる設定が追加されました。

```js:title=nuxt.config.js
export default {
  // 省略
  router: {
    trailingSlash: true
  }
}
```

この設定を有効にすることで**URL末尾に強制的にスラッシュが付与されます。**

- [Nuxt trailing slash](https://ja.nuxtjs.org/api/configuration-router/#trailingslash)
- [GitHub 関連issue](https://github.com/nuxt-community/nuxt-i18n/issues/422)

ただし、上記のNuxt公式ページの注意事項にもありますがこのオプションを有効にすると、**トレイリングスラッシュが付いていないURLについては無効となってしまいます。**

つまり`example.com/abc/`が有効となり、`example.com/abc`は機能しなくなります。`nuxt-link`で名前付きルートを使っている場合は問題ありませんが、直接パスを指定かつ末尾にスラッシュを付けていなかった場合はそれらのリンクが機能しなくなる（404エラー）ので注意が必要です。

また、トレイリングスラッシュ付きのURLへリダイレクトもされないので上記のようなコードがある場合はすべて修正が必要となります。

## リダイレクト処理を追加する

何かのタイミングでトレイリングスラッシュ無しのURLにアクセスされた時に404エラーとなってしまうのはよろしくないので、トレイリングスラッシュ有りのURLへリダイレクトさせる処理を追加します。

全てのルートに対してトレイリングスラッシュ有無の判定を行う必要があるので、そういう時はNuxtのミドルウェアを使って実装すると便利です。

[Nuxt ミドルウェア](https://ja.nuxtjs.org/guide/routing/#%E3%83%9F%E3%83%89%E3%83%AB%E3%82%A6%E3%82%A7%E3%82%A2)

作成したミドルウェアは下記で定義できます。

1. nuxt.config.js
1. マッチしたレイアウト
1. マッチしたページ

レイアウト・ページに定義することでそれらのルートにマッチした時のみミドルウェアが実行されます。今回は全ルートに対して処理を行いたいので`nuxt.config.js`へ定義します。

ミドルウェアは`middleware`ディレクトリ配下へ作成します。処理自体は単純で、コンテキストとして`route`を受け取れるので遷移先のパスを判定して、末尾にスラッシュがなければスラッシュを付与してリダイレクトさせています。

```js:title=redirect.js
export default function({ route, redirect }) {
  if (route.path.slice(-1) !== "/") {
    redirect(301, route.path + "/");
  }
}
```

あとは`nuxt.config.js`で上記のミドルウェアを定義してあげればOKです。

```js:title=nuxt.config.js
export default {
  // 省略
  router: {
    trailingSlash: true,
    middleware: "redirect"
  }
}
```

## おわりに

これでトレイリングスラッシュ付きのみの一貫したURLへ統一することができました。`trailingSlash`オプションを有効にするだけで簡単に実現できますが、適切なリダイレクトや既存ルートのテストなどちゃんと行う必要があることは注意してください。